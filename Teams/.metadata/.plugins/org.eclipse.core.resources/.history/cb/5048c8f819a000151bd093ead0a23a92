package squads.explorer;

//import java.util.ArrayList;

import squads.fsm.Fsm;
import edu.warbot.agents.agents.WarExplorer;
import edu.warbot.agents.percepts.WarAgentPercept;
import edu.warbot.agents.resources.WarFood;
import edu.warbot.brains.brains.WarExplorerBrain;

public class ExplorerStateCollectorSearchAndTakeFoods extends ExplorerState
{
	public ExplorerStateCollectorSearchAndTakeFoods(Fsm fsm, WarExplorerBrain web)
	{
		super(fsm, web);
	}
	
	public String execute()
	{
		web.setDebugString("Taking foods");
		WarAgentPercept food = foods.get(0);
		for(WarAgentPercept f : foods)
		{
			if(food.getDistance() > f.getDistance())
			{
				food = f;
			}
		}
		web.setHeading(food.getAngle());
		if(food.getDistance() <= WarFood.MAX_DISTANCE_TAKE)
		{
			return WarExplorer.ACTION_TAKE;
		}
		return WarExplorer.ACTION_MOVE;
	}
	
	public void reflexe()
	{
		super.reflexe();
		if(web.isBagFull() || (!web.isBagEmpty() && (bases != null) && (bases.size() > 0)))
		{
			fsm.pop();
			fsm.getCurrentState().reflexe();
			return;
		}
		if(foods.size() == 0)
		{
			web.setDebugString("Searching foods");
			fsm.push(new ExplorerStateWiggle(fsm, web));
		}
	}
}
